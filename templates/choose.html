<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Choose Your Food</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 20px;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px;
            margin-bottom: 20px;
        }

        nav {
            display: flex;
            justify-content: center;
            background-color: #666;
            padding: 10px;
            margin-bottom: 20px;
        }
        select {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
        .dishDropdownContainer {
            display: none;
        }

        #selectedData {
            margin-top: 20px;
        }

        .card {
            width: 100%;
        }


    </style>
</head>

<body>

<header>
    <h1 class="text-center">Choose Your Food</h1>
</header>

<nav class="mb-3">
    <a href="#" class="text-white">Home</a>
    <a href="#" class="text-white">About</a>
    <a href="#" class="text-white">Contact</a>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <label for="staples">Choose Your Staple:</label>
            <select id="staples"
                    onchange="updateSecondDropdown('staples', 'secondDishDropdown1', 'dishDropdownContainer1'); updateSecondDropdown('staples', 'secondDishDropdown2', 'dishDropdownContainer2')"
                    class="form-control">
                <option value="0" selected>Select Staple</option>
                <!-- Options will be populated dynamically using JavaScript -->
            </select>

            <div id="dishDropdownContainer1" class="dishDropdownContainer">
                <label for="secondDishDropdown1" class="mt-2">Choose Your Dish 1:</label>
                <select id="secondDishDropdown1" class="form-control"
                        onchange="updateCard('staples', 'secondDishDropdown1', 'secondDishDropdown2')">
                    <!-- Options will be populated dynamically using JavaScript -->
                </select>
            </div>

            <div id="dishDropdownContainer2" class="dishDropdownContainer">
                <label for="secondDishDropdown2" class="mt-2">Choose Your Dish 2:</label>
                <select id="secondDishDropdown2" class="form-control"
                        onchange="updateCard('staples', 'secondDishDropdown1', 'secondDishDropdown2')">
                    <!-- Options will be populated dynamically using JavaScript -->
                </select>
            </div>
            <div class="mt-4">
                <a id="all_results" class="btn btn-primary mt-3" href = '/all_results'>Show All Results</a>
            </div>
        </div>
        <div class="col-md-6">
            <div id="selectedData" class="card">
                <div class="card-body">
                    <h5 class="card-title">Selected Data</h5>
                    <p class="card-text" id="selectedText">No data selected.</p>
                </div>
            </div>
            <div class="mt-3">
                <button id="submitButton" class="btn btn-primary mt-3" onclick="submitSelection()">Submit</button>
            </div>
        </div>

    </div>

</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

<script>
    async function populateStaples() {
        // Fetch data from FastAPI endpoint
        const response = await fetch("/api/staples");
        const data = await response.json();
        const staples = data.staples;

        // Populate the dropdown
        addOptions("staples", staples);
    }

    function updateCard() {
    var selectedStaple = document.getElementById("staples").options[document.getElementById("staples").selectedIndex].text;
    var selectedDish1 = document.getElementById("secondDishDropdown1").options[document.getElementById("secondDishDropdown1").selectedIndex].text;
    var selectedDish2 = document.getElementById("secondDishDropdown2").options[document.getElementById("secondDishDropdown2").selectedIndex].text;

    // Create a table with three rows
    var table = document.createElement("table");

    // Row for Staple
    var row1 = table.insertRow(0);
    var cell1 = row1.insertCell(0);
    var cell2 = row1.insertCell(1);
    cell1.textContent = "Staple:";
    cell2.textContent = selectedStaple;
    cell2.id = "selectedStaple";

    // Row for Dish1
    var row2 = table.insertRow(1);
    var cell3 = row2.insertCell(0);
    var cell4 = row2.insertCell(1);
    cell3.textContent = "Dish1:";
    cell4.textContent = selectedDish1;
    cell4.id = "selectedDish1";

    // Row for Dish2
    var row3 = table.insertRow(2);
    var cell5 = row3.insertCell(0);
    var cell6 = row3.insertCell(1);
    cell5.textContent = "Dish2:";
    cell6.textContent = selectedDish2;
    cell6.id = "selectedDish2";

    // Clear the existing content and append the table to the "selectedText" div
    var selectedTextDiv = document.getElementById("selectedText");
    selectedTextDiv.innerHTML = '';
    selectedTextDiv.appendChild(table);
}


    async function updateSecondDropdown(sourceDropdownId, targetDropdownId, containerId) {
        var sourceDropdown = document.getElementById(sourceDropdownId);
        var targetDropdown = document.getElementById(targetDropdownId);
        var container = document.getElementById(containerId);

        // Reset target dropdown
        targetDropdown.innerHTML = '<option value="0">Select Dish</option>';

        // Check the selected value in the source dropdown
        var selectedValue = sourceDropdown.value;

        // Show or hide the target dropdown container based on selection
        container.style.display = selectedValue !== "0" ? "block" : "none";

        // If a value is selected, fetch and populate the target dropdown
        if (selectedValue !== "0") {
            // Fetch data from FastAPI endpoint based on selected value
            // Replace the "/api/dishes/{value}" endpoint with your actual endpoint
            const response = await fetch(`/api/dishes/${selectedValue}`);
            const data = await response.json();
            const dishes = data.dishes;

            // Populate the target dropdown
            addOptions(targetDropdownId, dishes);

            // Update the card with the selected values
            updateCard(
                sourceDropdown.options[sourceDropdown.selectedIndex].text,
                targetDropdown.options[targetDropdown.selectedIndex].text,  // Dish 1
                targetDropdown.options[0].text   // Dish 2
            );
        } else {
            // If no value is selected, update the card with default values
            updateCard("Not selected", "Not selected", "Not selected");
        }
    }

    function addOptions(selectElementId, optionsArray) {
        var selectElement = document.getElementById(selectElementId);

        optionsArray.forEach(function (optionText, index) {
            var option = document.createElement("option");
            option.value = index + 1;  // You may want to adjust the value
            option.text = optionText;
            selectElement.add(option);
        });
    }

    // Function to handle submit button click
        function submitSelection() {
            // You can add your logic here to perform a POST request with the selected data
            // For now, I'm just logging the selected data to the console
            var selectedStaple = document.getElementById("selectedStaple").textContent;
            var selectedDish1 = document.getElementById("selectedDish1").textContent;
            var selectedDish2 = document.getElementById("selectedDish2").textContent;

            console.log("Selected Staple:", selectedStaple);
            console.log("Selected Dish 1:", selectedDish1);
            console.log("Selected Dish 2:", selectedDish2);

            // If you want to perform a POST request, you can use the fetch API here
            // Example:
            fetch("/submit", {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
                 },
                 body: JSON.stringify({
                     staple: selectedStaple,
                     dish1: selectedDish1,
                     dish2: selectedDish2,
                 }),
             })
             .then(response => response.json())
             .then(data => console.log("Submit response:", data))
             .catch(error => console.error('Error submitting data:', error));
        }


    // Call the function to populate the options initially
    populateStaples();

</script>


</body>

</html>
